# Version Blacklist - 版本黑名单

## 说明

本项目的版本黑名单，列出了本项目的版本黑名单，请注意避免使用这些版本。

列入黑名单的版本，可能是因为以下原因：

- 该版本存在严重的 Bug，可能会导致核心功能无法正常使用。
- 该版本存在严重的 Bug，可能会导致数据丢失、数据错误等严重后果。

## 设计目的

该黑名单旨在帮助开发人员快速识别各版本中已知的问题点，明确受影响的模块与典型触发场景，从而做出基于事实的用/避决策与迁移安排，
而不是简单地“一刀切”禁用某一版本。

## 如何使用

黑名单不是绝对禁用清单。遇到被列入黑名单的版本时，应当基于“问题原因—是否命中—影响面”的原则进行研判：

- 是否直接或间接使用了被提及的模块/类（例如：`com.dwarfeng.settingrepo.impl.handler.LongTextNodeOperateHandlerImpl`）。
- 业务中是否存在与“原因”描述相符的顺序敏感或易触发场景（例如：对列表型缓存的严格顺序一致性要求）。
- 是否已出现与问题相符的日志告警、数据核对失败或线上异常案例。

若未使用黑名单中提及的问题代码部分，或经过验证不命中触发条件，则仍然可以继续使用该版本；若命中或存在较大不确定性，
建议参考对应编号“详细原因”章节末尾的迁移建议执行升级或规避方案，并充分做回归与灰度验证。

请注意：迁移建议仅针对对应编号的问题，所推荐版本可能仍存在其他风险。请继续核查该推荐版本是否仍在黑名单中；
若仍在黑名单中，请持续研判并迭代升级，直至风险可接受或升级至未被列入黑名单的版本。

## 版本黑名单

| 编号                                                 | 大版本   | 起始版本    | 结束版本    | 原因           |
|----------------------------------------------------|-------|---------|---------|--------------|
| [BLACKLIST-20260105.1](#BLACKLIST-202601051)       | 2.4.x | 2.4.2.a | 2.4.2.a | 导航条目更新逻辑存在缺陷 |
| [BLACKLIST-LEGACY-2.2.0.a](#BLACKLIST-LEGACY-220a) | 2.2.x | 2.2.0.a | 2.2.0.a | 核心功能无法正常使用   |

## 详细原因

### BLACKLIST-20260105.1

原因：导航条目更新逻辑存在缺陷，在更新根节点条目或未修改索引时可能导致异常。

- 受影响模块/类：
   - `com.dwarfeng.settingrepo.impl.handler.NavigationNodeOperateHandlerImpl`。
- 典型触发条件：
   - 更新根节点条目（parentItemKey 为 null）时，代码未判断 parentItemKey 是否为 null，直接进行验证操作。
   - 更新条目但不改变 index 值时，代码仍会进行索引冲突检查，可能触发不必要的异常。
- 典型症状：
   - 更新根节点条目时抛出空指针异常或验证异常。
   - 更新条目但不改变 index 时可能抛出不必要的索引冲突异常。
- 影响范围：
   - 直接或间接使用 `NavigationNodeOperateHandler.updateItem()` 方法的功能与接口。
   - 更新导航节点条目的业务操作，特别是更新根节点条目或仅更新非索引字段的场景。

迁移建议：升级至 2.4.4.a 及以上版本。

### BLACKLIST-LEGACY-2.2.0.a

原因：存在严重 bug，导致部分核心业务无法正常使用。

- 受影响模块/类：
   - `com.dwarfeng.settingrepo.impl.handler.LongTextNodeOperateHandlerImpl`。
   - `com.dwarfeng.settingrepo.impl.handler.ImageNodeOperateHandlerImpl`。
- 典型触发条件：
   - 对已存在的长文本节点或图片节点进行文件更新操作。
   - 更新操作会修改文件内容，但文件信息（文件名、大小等）不会同步更新。
- 典型症状：
   - 文件下载时，获取错误的文件名称和大小。
   - 下载的文件可能损坏或无法正常使用。
- 影响范围：
   - 直接或间接使用上述处理器进行文件更新操作的功能与接口。
   - 依赖文件信息进行下载、校验等操作的上层功能。

迁移建议：升级至 2.2.1.a 及以上版本。

## 注意事项

- 黑名单用于风险提示，并非强制禁用。是否升级或规避，应以是否命中“详细原因”所述的模块与场景为依据。
- 建议遵循生产变更流程：评估 -> 测试 -> 灰度 -> 观测 -> 全量，过程中启用充分的日志与指标监控。
- 如发现新问题或修复版本，请同步更新本黑名单与变更记录，保持信息一致性。
